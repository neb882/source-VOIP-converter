<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>TF2 Voice Emulator â€” Developer Console</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="card" id="main-card">
    <!-- Authentic Net Graph Overlay -->
    <div id="net-graph" class="ng-level-0">
      <div class="ng-row-basic">fps: <span class="ng-fps" id="ng-fps">0</span> <span class="ng-row-graph"><span class="ng-bar"><span class="ng-bar-fill" id="ng-fill"></span></span></span></div>
      <div class="ng-row-basic">ping: <span class="ng-ping" id="ng-ping">5</span> ms</div>
      <div class="ng-row-advanced">in : <span id="ng-in">128</span> 2.11 k/s</div>
      <div class="ng-row-advanced">out: <span id="ng-out">64</span> 1.02 k/s</div>
      <div class="ng-row-advanced">lerp: <span class="ng-lerp" id="ng-lerp">100.0</span> ms</div>
      <div class="ng-row-basic">loss: <span class="ng-loss" id="ng-loss-val">0</span> choke: 0</div>
      <div class="ng-row-sv">sv: 3.4 +- 0.2 ms</div>
    </div>

    <h1>TF2 Voice Emulator</h1>
    <p>Source Engine Processing &amp; Artifacts</p>

    <div class="upload-row">
      <input id="file" type="file" accept="audio/*">
      <button id="process" disabled>Process Audio</button>
      <a id="download" class="button" download disabled>Download WAV</a>
    </div>

    <div class="preset-row">
      <div class="preset-label">Quick Presets</div>
      <button class="preset-btn" data-cmd="exec preset_modern">Authentic (Modern)</button>
      <button class="preset-btn" data-cmd="exec preset_legacy">Legacy (2007 Era)</button>
      <button class="preset-btn" data-cmd="exec preset_spam">Mic Spam (Loud)</button>
    </div>

    <div class="controls" id="controls-wrapper">
      <div class="control">
        <label>Rate (Hz) [host_framerate]</label>
        <input id="sr" type="number" value="22050" step="50">
      </div>

      <div class="control">
        <label>Mic Gain [voice_scale]</label>
        <input id="gain" type="number" value="1.2" min="1.0" max="5.0" step="0.1">
      </div>

      <div class="control">
        <label>Hi-Pass [dsp_hpf]</label>
        <input id="hp" type="number" value="300" min="0" max="1000">
      </div>

      <div class="control">
        <label>Lo-Pass [dsp_lpf]</label>
        <input id="lp" type="number" value="6000" min="1000" max="20000">
      </div>

      <div class="control">
        <label>Environment [dsp_room]</label>
        <select id="env">
          <option value="none">0 - Dry</option>
          <option value="room">14 - Room</option>
          <option value="locker">19 - Locker</option>
          <option value="hall">22 - Hallway</option>
          <option value="custom">99 - Custom</option>
        </select>
      </div>

      <div id="custom-env" class="control">
        <label style="margin-bottom:12px; border-bottom:1px solid #444; padding-bottom:4px;">dsp_custom settings</label>
        <div class="custom-row">
          <div class="custom-col">
             <label>Time [dsp_custom_time]</label>
             <input id="c_dur" type="number" value="1.5" step="0.1">
          </div>
          <div class="custom-col">
             <label>Decay [dsp_custom_decay]</label>
             <input id="c_dec" type="number" value="3.0" step="0.1">
          </div>
          <div class="custom-col">
             <label>Mix [dsp_custom_mix]</label>
             <input id="c_mix" type="number" value="25">
          </div>
        </div>
      </div>

      <div class="control">
        <label>Bit Depth [snd_bits]</label>
        <input id="bits" type="number" value="16" min="4" max="16">
      </div>

      <div class="control">
        <label>Packet Size [net_split]</label>
        <input id="frameMs" type="number" value="20" min="10" max="100">
      </div>

      <div class="control">
        <label>Loss % [net_fakeloss]</label>
        <input id="loss" type="number" value="0" min="0" max="40">
      </div>
    </div>

    <div class="viz-container">
      <div class="scanlines"></div>
      <canvas id="visualizer"></canvas>
    </div>

    <audio id="preview" controls crossorigin="anonymous"></audio>
    
    <div class="console-wrapper">
      <div id="console-out" class="console-output"></div>
      <div class="console-input-row">
        <span>]</span>
        <!-- Input hint sits behind the real input -->
        <div id="console-hint"></div>
        <input type="text" id="console-input" placeholder="" autocomplete="off" spellcheck="false">
      </div>
    </div>

    <footer>
      Local Browser Processing | Source Engine Simulation
    </footer>
  </div>

  <script src="constants.js"></script>
  <script src="script.js"></script>
</body>
</html>